!function(e,t,s,a){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=r(a),l={data:()=>({user:null}),render({user:t}){return e.createVNode(e.resolveComponent("router-view"),{setUser:this.setUser,user:t},null)},created(){const e=+window.localStorage.getItem("theme")||0;document.getElementsByTagName("body")[0].className=["","sand","nord","gruvbox","lightsout"][e]},methods:{setUser(e){this.user=e,window.localStorage.setItem("user",JSON.stringify(e))}}},n={props:["content"],render:({content:t})=>e.createVNode("button",{type:"submit"},[t,e.createVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50.96 37"},[e.createVNode("path",{d:"M50.96 18.5L32.45 37h-9.9l14.99-15H0v-7h37.54L22.55 0h9.9l18.51 18.5z"},null)])])},i={props:["user","setUser"],data:()=>({err:null,username:"",password:""}),render(){return e.createVNode("div",{class:"container"},[e.createVNode("form",{onSubmit:e=>{e.preventDefault(),this.login()}},[e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.username=e,type:"text",placeholder:"Identifiant / Email",autocomplete:"username",maxlength:"32"},null),[[e.vModelText,this.username]]),e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.password=e,type:"password",placeholder:"Mot de passe",autocomplete:"current-password"},null),[[e.vModelText,this.password]]),this.err&&e.createVNode("p",{class:"error"},[this.err]),e.createVNode(n,{content:"Se connecter"},null)]),e.createVNode(e.resolveComponent("router-link"),{to:"/register"},{default:()=>[e.createTextVNode("Se créer un compte")]})])},methods:{getErrorFromHttpStatus:e=>401===e?"Identifiants invalides":"Il y'a eu un problème. Veuillez réessayer plus tard",login(){const{username:e,password:t}=this;if(!(e&&t))return this.err="Veuillez remplir tous les champs";s.post("/api/v1/login",{username:e,password:t}).then((e=>{this.setUser(e.data),this.$router.push("app")})).catch((e=>this.err=this.getErrorFromHttpStatus(e.response.status)))}}},d={props:["user","setUser"],data:()=>({isLoggedIn:!1,err:null,email:"",username:"",password:""}),render(){return e.createVNode("div",{class:"container"},[e.createVNode("form",{onSubmit:e=>{e.preventDefault(),this.register()}},[e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.email=e,type:"text",placeholder:"Adresse email"},null),[[e.vModelText,this.email]]),e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.username=e,type:"text",placeholder:"Identifiant"},null),[[e.vModelText,this.username]]),e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.password=e,type:"password",placeholder:"Mot de passe"},null),[[e.vModelText,this.password]]),this.err&&e.createVNode("p",{class:"error"},[this.err]),e.createVNode(n,{content:"S'inscrire"},null)]),e.createVNode(e.resolveComponent("router-link"),{to:"/login"},{default:()=>[e.createTextVNode("Se connecter")]})])},methods:{getErrorFromHttpStatus:e=>Object.freeze({403:"Cet email n'est pas whitelisté",409:"Un compte associé à cet email/identifiant existe déjà"})[e]||"Il y'a eu un problème. Veuillez réessayer plus tard",validateEmail:e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase()),register(){const{email:e,username:t,password:a}=this;return e&&t&&a?this.validateEmail(e)?void s.post("/api/v1/register",{email:e,username:t,password:a}).then((e=>{this.setUser(e.data),this.$router.push("app")})).catch((e=>this.err=this.getErrorFromHttpStatus(e.response.status))):this.err="Adresse email invalide":this.err="Veuillez remplir tous les champs"}}};var c={props:["message"],render({message:t}){return e.createVNode("div",{class:"message"},[t.author.admin&&e.createVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10"},[e.createVNode("path",{d:"M5,0a5,5,0,1,0,5,5A5,5,0,0,0,5,0Zm.912,5.912L5,8.333,4.088,5.912,1.667,5l2.421-.912L5,1.667l.912,2.421L8.333,5Z",fill:t.author.color},null)]),e.createVNode("h2",{style:{color:t.author.color}},[t.author.username,e.createVNode("span",null,[this.formatDate(t.timestamp)])]),e.createVNode("div",{innerHTML:(s=t.content,o.default(s,{allowedTags:[],allowedAttributes:{},disallowedTagsMode:"recursiveEscape"}).replace(/(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/g,'<a href="$1" target="blank" rel="noreferrer noopener">$1</a>').replace(/\*\*(.*)\*\*/g,"<b>$1<b>").replace(/\*(.*)\*/g,"<i>$1</i>").replace(/__(.*)__/g,"<u>$1</u>").replace(/~~(.*)~~/g,"<strike>$1</strike>"))},null)]);var s},methods:{formatDate:e=>`(à ${new Intl.DateTimeFormat("fr-fr",{hour:"2-digit",minute:"2-digit"}).format(e)})`}},u={props:["close","user"],data:()=>({userDetails:{}}),render({close:t,userDetails:s}){return e.createVNode("div",{class:"settings"},[e.createVNode("div",{class:"backdrop",onClick:t},null),e.createVNode("div",{class:"modal"},[e.createVNode("h3",null,[e.createTextVNode("Email")]),e.createVNode("span",null,[s?.email||""]),e.createVNode("h3",null,[e.createTextVNode("Nom d'utilisateur")]),e.createVNode("span",null,[s?.username||""]),e.createVNode("h3",null,[e.createTextVNode("Couleur")]),e.createVNode("span",null,[s?.color||""]),e.createVNode("span",{class:"color",style:{backgroundColor:s.color}},null),e.createVNode("p",{class:"link",onCLick:this.switchTheme},[e.createTextVNode("Changer de thème")]),s?.admin&&e.createVNode(e.resolveComponent("router-link"),{to:"/admin"},{default:()=>[e.createTextVNode("Admin panel")]}),e.createVNode("p",{class:"logout",onclick:this.logout},[e.createTextVNode("Se déconnecter")])])])},created(){this.userDetails=this.user||JSON.parse(window.localStorage.getItem("user")),this.userDetails||s.get("/api/v1/user").then((e=>{this.userDetails=e.data,window.localStorage.setItem("user",JSON.stringify(e.data))})).catch((()=>this.$router.push("login")))},methods:{logout(){s.post("/api/v1/logout"),this.$router.push("/login")},switchTheme(){const e=["","sand","nord","gruvbox","lightsout"];let t=+window.localStorage.getItem("theme")||0;t=e.length>t+1?t+1:0,window.localStorage.setItem("theme",t),document.getElementsByTagName("body")[0].className=e[t]}}},h={props:["ws"],data:()=>({message:"",lastMessage:""}),render({message:t}){return e.createVNode("form",null,[!t&&e.createVNode("span",{class:"placeholder"},[e.createTextVNode("Message...")]),e.createVNode("div",{onInput:this.setMessage,class:"chatbox",role:"textbox",contenteditable:"true",spellcheck:"true",autocorrect:"false",ref:"messageBar"},[e.createVNode("br",null,null)])])},mounted(){const e=this.$refs.messageBar;e.addEventListener("keydown",(t=>{if("Enter"!==t.code||t.shiftKey)"ArrowUp"!==t.code||this.message||(t.preventDefault(),this.message=this.lastMessage,e.innerText=this.lastMessage,(e=>{let t,s;document.createRange?(t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),s=window.getSelection(),s.removeAllRanges(),s.addRange(t)):document.selection&&(t=document.body.createTextRange(),t.moveToElementText(e),t.collapse(!1),t.select())})(e));else{if(t.preventDefault(),!/\S/.test(this.message))return;this.sendMessage(this.message),e.innerText=""}}))},methods:{setMessage(e){this.message=e.target.innerText},sendMessage(){/\S/.test(this.message)&&(this.lastMessage=this.message,this.ws.send(JSON.stringify({op:1,content:this.message})),this.message="")}}},p={props:["user","setUser"],data:()=>({messages:[],showSettingsModal:!1}),render({user:t,messages:s}){return e.createVNode("div",{class:"container chat"},[e.createVNode("div",{class:"messageContainer"},[s.map(((t,s)=>e.createVNode(c,{message:t,key:s},null))),e.createVNode("div",{id:"bot",ref:"bottom"},null)]),e.createVNode(h,{ws:this.ws},null),e.createVNode("div",{class:"settingsButton",onClick:this.toggleSettingsModal},[e.createVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10"},[e.createVNode("path",{d:"M8.82 5.49A3.716 3.716 0 0 0 8.856 5a3.716 3.716 0 0 0-.036-.49l1.08-.825a.248.248 0 0 0 .062-.32l-1.023-1.73a.26.26 0 0 0-.227-.125.249.249 0 0 0-.087.015l-1.28.5a3.769 3.769 0 0 0-.869-.49L6.281.21A.248.248 0 0 0 6.029 0H3.973a.25.25 0 0 0-.252.21l-.2 1.325a3.962 3.962 0 0 0-.869.49l-1.28-.5a.3.3 0 0 0-.092-.015.255.255 0 0 0-.221.125L.036 3.365a.242.242 0 0 0 .061.32l1.085.825a3.78 3.78 0 0 0-.036.49 3.78 3.78 0 0 0 .036.49L.1 6.315a.248.248 0 0 0-.061.32l1.028 1.73a.257.257 0 0 0 .226.125.241.241 0 0 0 .087-.015l1.28-.5a3.769 3.769 0 0 0 .869.49l.2 1.325a.25.25 0 0 0 .252.21h2.048a.248.248 0 0 0 .252-.21l.2-1.325a3.962 3.962 0 0 0 .869-.49l1.28.5a.3.3 0 0 0 .093.015.257.257 0 0 0 .221-.125l1.028-1.73a.248.248 0 0 0-.062-.32zM7.8 4.635A2.671 2.671 0 0 1 7.828 5a3.72 3.72 0 0 1-.025.365l-.072.565.457.35.555.42-.36.6-.652-.25-.531-.21-.463.34a3.022 3.022 0 0 1-.642.365l-.545.215-.082.565L5.361 9h-.72l-.1-.675-.08-.565-.544-.215a2.953 2.953 0 0 1-.633-.355l-.467-.35-.545.215-.653.255-.36-.6.555-.42.458-.35-.072-.57L2.174 5a3.561 3.561 0 0 1 .026-.365l.072-.565-.458-.35-.555-.42.36-.6.653.255.534.21.463-.34a3.046 3.046 0 0 1 .642-.365l.545-.215.083-.565.102-.68h.715l.1.675.083.565.545.215a2.946 2.946 0 0 1 .632.355l.468.35.544-.215.653-.255.36.605-.55.425-.457.35zM5 3a2.028 2.028 0 0 0-2.055 2A2.028 2.028 0 0 0 5 7a2.028 2.028 0 0 0 2.057-2A2.028 2.028 0 0 0 5 3zm0 3a1 1 0 1 1 1.029-1A1.018 1.018 0 0 1 5 6z",fill:"currentColor"},null)])]),this.showSettingsModal&&e.createVNode(u,{close:this.toggleSettingsModal,user:t},null)])},updated(){!1===this.showSettingsModal&&this.$refs.bottom.scrollIntoView({behavior:"smooth"})},methods:{toggleSettingsModal(){this.showSettingsModal=!this.showSettingsModal}},created(){let e;const t=`ws://${window.location.host}/ws`;this.ws=new WebSocket(t),this.ws.onmessage=t=>{const s=JSON.parse(t.data);switch(s.op){case 0:this.messages.push(s.d);break;case 2:e=setInterval((()=>{this.ws.send('{"op":3}')}),s.d)}},this.ws.onclose=()=>{clearInterval(e),this.ws=new WebSocket(t)}}},m={props:["user","setUser"],data:()=>({users:[]}),render(){return e.createVNode("div",{class:"container chat admin"},[this.users.map(((t,s)=>e.createVNode("div",{class:"user",key:s},[e.createVNode("p",{style:{color:t.color}},[t.username]),e.createVNode("p",null,[t.email])]))),e.createVNode("p",{onClick:this.fetchUsers},[e.createTextVNode("Refresh")]),e.createVNode(e.resolveComponent("router-link"),{to:"/app"},{default:()=>[e.createTextVNode("Go back")]})])},created(){this.fetchUsers()},methods:{fetchUsers(){s.get("/api/v1/all").then((e=>this.users=e.data.filter(((e,t,s)=>s.findIndex((t=>t.username===e.username))===t)))).catch((()=>this.$router.push("/login")))}}};const g=t.createRouter({history:t.createWebHistory(),routes:[{path:"/",redirect:"/login"},{path:"/login",component:i},{path:"/register",component:d},{path:"/app",component:p},{path:"/admin",component:m},{path:"/:pathMatch(.*)*",redirect:"/login"}]});g.beforeEach(((e,t,a)=>{"/app"===e.path?s.get("/api/v1/user").then((()=>a())).catch((()=>a({path:"/login"}))):"/admin"===e.path?s.get("/api/v1/user").then((e=>e.data.admin?a():a({path:"/login"}))).catch((()=>a({path:"/login"}))):a()}));const w=e.createApp(l).use(g);g.isReady().then((()=>{w.mount("body")}))}(Vue,VueRouter,axios,sanitizeHtml);
