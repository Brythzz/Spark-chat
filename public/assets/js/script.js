!function(e,t,s,r){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=a(r),i={render:()=>e.createVNode(e.resolveComponent("router-view"),null,null)},n={props:["content"],render:({content:t})=>e.createVNode("button",{type:"submit"},[t,e.createVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50.96 37"},[e.createVNode("path",{d:"M50.96 18.5L32.45 37h-9.9l14.99-15H0v-7h37.54L22.55 0h9.9l18.51 18.5z"},null)])])},l={data:()=>({err:null,username:"",password:""}),render(){return e.createVNode("div",{class:"container"},[e.createVNode("form",{onSubmit:e=>{e.preventDefault(),this.login()}},[e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.username=e,type:"text",placeholder:"Identifiant / Email",autocomplete:"username",maxlength:"32"},null),[[e.vModelText,this.username]]),e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.password=e,type:"password",placeholder:"Mot de passe",autocomplete:"current-password"},null),[[e.vModelText,this.password]]),this.err&&e.createVNode("p",{class:"error"},[this.err]),e.createVNode(n,{content:"Se connecter"},null)]),e.createVNode(e.resolveComponent("router-link"),{to:"/register"},{default:()=>[e.createTextVNode("Se créer un compte")]})])},methods:{getErrorFromHttpStatus:e=>401===e?"Identifiants invalides":"Il y'a eu un problème. Veuillez réessayer plus tard",login(){const{username:e,password:t}=this;if(!(e&&t))return this.err="Veuillez remplir tous les champs";s.post("/api/v1/login",{username:e,password:t}).then((()=>this.$router.push("app"))).catch((e=>this.err=this.getErrorFromHttpStatus(e.response.status)))}}},d={data:()=>({isLoggedIn:!1,err:null,email:"",username:"",password:""}),render(){return e.createVNode("div",{class:"container"},[e.createVNode("form",{onSubmit:e=>{e.preventDefault(),this.register()}},[e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.email=e,type:"text",placeholder:"Adresse email"},null),[[e.vModelText,this.email]]),e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.username=e,type:"text",placeholder:"Identifiant"},null),[[e.vModelText,this.username]]),e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.password=e,type:"password",placeholder:"Mot de passe"},null),[[e.vModelText,this.password]]),this.err&&e.createVNode("p",{class:"error"},[this.err]),e.createVNode(n,{content:"S'inscrire"},null)]),e.createVNode(e.resolveComponent("router-link"),{to:"/login"},{default:()=>[e.createTextVNode("Se connecter")]})])},methods:{getErrorFromHttpStatus:e=>Object.freeze({403:"Cet email n'est pas whitelisté",409:"Un compte associé à cet email/identifiant existe déjà"})[e]||"Il y'a eu un problème. Veuillez réessayer plus tard",validateEmail:e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase()),register(){const{email:e,username:t,password:r}=this;return e&&t&&r?this.validateEmail(e)?void s.post("/api/v1/register",{email:e,username:t,password:r}).then((()=>this.$router.push("app"))).catch((e=>this.err=this.getErrorFromHttpStatus(e.response.status))):this.err="Adresse email invalide":this.err="Veuillez remplir tous les champs"}}},c={props:["message"],render({message:t}){return e.createVNode("div",{class:"message"},[t.author.admin&&e.createVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10"},[e.createVNode("path",{d:"M5,0a5,5,0,1,0,5,5A5,5,0,0,0,5,0Zm.912,5.912L5,8.333,4.088,5.912,1.667,5l2.421-.912L5,1.667l.912,2.421L8.333,5Z",fill:t.author.color},null)]),e.createVNode("h2",{style:{color:t.author.color}},[t.author.username,e.createVNode("span",{class:"timestamp"},[e.createTextVNode("(à "),this.formatDate(t.timestamp),e.createTextVNode(")")])]),e.createVNode("div",{innerHTML:this.parseMarkdown(t.content)},null)])},methods:{formatDate:e=>new Intl.DateTimeFormat("fr-fr",{hour:"2-digit",minute:"2-digit"}).format(e),parseMarkdown:e=>o.default(e,{allowedTags:[],allowedAttributes:{},disallowedTagsMode:"recursiveEscape"}).replace(/(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/g,'<a src="$1" target="blank" rel="noreferrer noopener">$1</a>').replace(/\*\*(.*)\*\*/g,"<b>$1<b>").replace(/\*(.*)\*/g,"<i>$1</i>").replace(/__(.*)__/g,"<u>$1</u>").replace(/~~(.*)~~/g,"<strike>$1</strike>")}},p={data:()=>({messages:[],message:"",lastMessage:""}),render(){return e.createVNode("div",{class:"container chat"},[e.createVNode("div",{class:"messageContainer"},[this.messages.map(((t,s)=>e.createVNode(c,{message:t,key:s},null))),e.createVNode("div",{id:"bot",ref:"bottom"},null)]),e.createVNode("form",{onSubmit:e=>{e.preventDefault(),this.sendMessage()}},[e.withDirectives(e.createVNode("input",{"onUpdate:modelValue":e=>this.message=e,type:"text",placeholder:"Message...",maxlength:"512",ref:"messageBar"},null),[[e.vModelText,this.message]])])])},created(){let e;this.ws=new WebSocket(`ws://${window.location.host}/ws`),this.ws.onmessage=t=>{const s=JSON.parse(t.data);switch(s.op){case 0:this.messages.push(s.d);break;case 2:e=setInterval((()=>{this.ws.send('{"op":3}')}),s.d)}},this.ws.onclose=()=>{clearInterval(e),this.ws=new WebSocket(`ws://${window.location.host}/ws`)}},mounted(){this.$refs.messageBar.addEventListener("keydown",(e=>{38!==e.keyCode||this.message||(e.preventDefault(),this.message=this.lastMessage)}))},updated(){this.$refs.bottom.scrollIntoView({behavior:"smooth"})},methods:{sendMessage(){this.message&&(this.lastMessage=this.message,this.ws.send(JSON.stringify({op:1,content:this.message})),this.message="")}}};const u=t.createRouter({history:t.createWebHistory(),routes:[{path:"/",redirect:"/login"},{path:"/login",component:l},{path:"/register",component:d},{path:"/app",component:p},{path:"/:pathMatch(.*)*",redirect:"/login"}]});u.beforeEach(((e,t,r)=>{"/app"===e.path?s.get("/api/v1/user").then((()=>r())).catch((()=>r({path:"/login"}))):r()}));const h=e.createApp(i).use(u);u.isReady().then((()=>{h.mount("body")}))}(Vue,VueRouter,axios,sanitizeHtml);
